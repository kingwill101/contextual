# Console Driver

The Console driver writes log messages to standard output (stdout). It’s a zero‑config, low‑latency destination that pairs well with human‑readable formatters during development and with JSON for production/containerized environments.

## Features

- Instant, low-overhead output to stdout
- Works with any formatter (Pretty, Plain, JSON)
- Great for local development and container logs
- Supports middleware enrichment and sampling strategies
- Can be combined via the Stack driver with other outputs

---

## Basic Usage

### Typed configuration (recommended)

Use the typed `ConsoleChannel` with `ConsoleOptions` for compile‑time safety and clarity:

```dart
import 'package:contextual/contextual.dart';

void main() async {
  final logger = await Logger.create(
    config: LogConfig(
      channels: const [
        ConsoleChannel(
          ConsoleOptions(),
          name: 'console',
        ),
      ],
    ),
  );

  logger.info('Hello from Contextual (console)!');
}
```

- Give the channel a name (e.g. `console`) so you can target it later.
- You can also provide a channel-specific `formatter` (see Formatting below).

### Raw/imperative wiring

You can also wire the driver directly using the imperative API:

```dart
import 'package:contextual/contextual.dart';

void main() async {
  final logger = await Logger.create();

  // Add a console channel using the raw driver
  logger.addChannel('console', ConsoleLogDriver());

  logger.info('Logging to console via raw driver');

  // Optionally remove, replace, or re-add channels at runtime
  logger
    ..removeChannel('console')
    ..addChannel('console', ConsoleLogDriver());
}
```

---

## Configuration Options

`ConsoleOptions` currently has no fields. It exists for consistency and future expansion. Typical usage:

```dart
const options = ConsoleOptions();

final logger = await Logger.create(
  config: LogConfig(
    channels: [
      ConsoleChannel(options, name: 'console'),
    ],
  ),
);
```

---

## Targeting the Console Channel

You can target the console output specifically either by channel name, or by driver type:

- By name:
  ```dart
  logger['console']?.info('Only goes to the console channel');
  ```

- By driver type:
  ```dart
  logger.forDriver<ConsoleLogDriver>().info('All console drivers');
  ```

---

## Formatting

Console output is only as useful as its formatting. Pair the Console driver with the formatter that fits your use case:

- PrettyLogFormatter: Human-friendly, colorized output (great for development)
- PlainTextLogFormatter: Minimal, fast text output
- JsonLogFormatter: Structured logs for ingestion and search (great for production)

### Global (logger-wide) formatter

```dart
final logger = await Logger.create(
  config: LogConfig(
    formatter: PrettyLogFormatter(),
    channels: const [
      ConsoleChannel(ConsoleOptions(), name: 'console'),
    ],
  ),
);
```

### Per-channel formatter (typed config)

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: const [
      ConsoleChannel(
        ConsoleOptions(),
        name: 'console',
        formatter: PrettyLogFormatter(),
      ),
    ],
  ),
);
```

### Per-channel formatter (imperative)

```dart
final logger = await Logger.create();

logger.addChannel(
  'console',
  ConsoleLogDriver(),
  formatter: JsonLogFormatter(),
);
```

Tip: Use PrettyLogFormatter locally, and JsonLogFormatter in production for structured log pipelines.

---

## Examples

### With middleware enrichment

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: const [
      ConsoleChannel(ConsoleOptions(), name: 'console'),
    ],
    middlewares: [
      () => {
        'env': 'production',
        'version': '2.0.0',
        'ts': DateTime.now().toIso8601String(),
      },
    ],
  ),
);

logger.info('Application started');
```

### Stacking Console with File output

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: const [
      // A stack channel can reference other channels by name
      StackChannel(
        StackOptions(
          channels: ['console', 'file'],
          ignoreExceptions: true,
        ),
        name: 'stack',
      ),
      ConsoleChannel(ConsoleOptions(), name: 'console'),
      DailyFileChannel(
        DailyFileOptions(path: 'logs/app', retentionDays: 14),
        name: 'file',
      ),
    ],
  ),
);
```

### Sampling noisy logs to console

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: const [
      ConsoleChannel(ConsoleOptions(), name: 'console'),
      // Wrap the console output with sampling
      SamplingChannel(
        SamplingOptions(
          // Example rates per level; values between 0.0 and 1.0
          rates: {
            Level.debug: 0.1, // keep 10% of debug logs
            Level.info: 1.0,   // keep all info logs
          },
          wrappedChannel: 'console', // wrap the named console channel
        ),
        name: 'console_sampled',
      ),
    ],
  ),
);

// Use the sampled channel by name if you want to route only specific logs:
logger['console_sampled']?.debug('This debug log may be sampled');
```

---

## Best Practices

- Use PrettyLogFormatter in development for readability; use JsonLogFormatter in production for machine parsing.
- Enrich logs with middleware (request IDs, user IDs, version, env) for better diagnostics.
- Use levels appropriately and consider Sampling/Stack drivers for high-volume scenarios.
- If you need durability or retention, pair Console with the Daily File driver via the Stack driver.
- Prefer typed channels in configuration for safety; use imperative APIs for dynamic runtime wiring or tests.

---

## Next Steps

- [Driver Configuration](configuration)
- [Middleware Guide](../../advanced/middleware)
- [Batching & Shutdown](../../advanced/batching-and-shutdown)
- [Daily File Driver](daily-file)
- [API Overview](/api/overview)