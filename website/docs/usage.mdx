---
title: Usage
---

# Usage Guide

This guide covers common usage patterns and best practices for Contextual v2.

## Basic Logging

```dart
import 'package:contextual/contextual.dart';

void main() async {
  final logger = await Logger.create(
    config: LogConfig(
      channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
    ),
  );
  logger.info('Application started');
  logger.warning('This is a warning');
  logger.error('Something went wrong', Context({'error_code': 500}));
}
```

## Structured Logging with Context

```dart
// Add global context
final logger = await Logger.create(
  config: LogConfig(
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
    context: {'app': 'MyApp', 'version': '1.0.0'},
  ),
);

// Add request-specific context
logger.info('User logged in', Context({
  'user_id': '12345',
  'ip_address': '192.168.1.1',
  'user_agent': 'Mozilla/5.0...',
}));
```

## Multiple Channels and Targeting

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: [
      ConsoleChannel(ConsoleOptions(), name: 'console'),
      DailyFileChannel(
        DailyFileOptions(path: 'logs/app'),
        name: 'file',
      ),
    ],
  ),
);

// Log to all channels
logger.info('General message');

// Target specific channel by name
logger['console'].debug('Console only');

// Target all channels of a type
logger.forDriver<ConsoleLogDriver>().info('All console channels');
```

## Custom Formatters

```dart
class CustomFormatter extends LogMessageFormatter {
  @override
  String format(LogRecord record) {
    return '[${record.level.name.toUpperCase()}] ${record.message}';
  }
}

final logger = await Logger.create(
  config: LogConfig(
    formatter: CustomFormatter(),
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
  ),
);
```

## Middleware for Enrichment

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
    middlewares: [
      () => {'timestamp': DateTime.now().toIso8601String()},
      RequestIdMiddleware(),
    ],
  ),
);

class RequestIdMiddleware implements Middleware {
  @override
  LogEntry handle(LogEntry entry) {
    // Add request ID if not present
    final context = entry.record.context;
    if (!context.all().containsKey('request_id')) {
      return entry.copyWith(context: Context({
        ...context.all(),
        'request_id': generateRequestId(),
      }));
    }
    return entry;
  }
}
```

## Error Handling and Logging

```dart
try {
  riskyOperation();
} catch (e, stackTrace) {
  logger.error('Operation failed', Context({
    'error': e.toString(),
    'stack_trace': stackTrace.toString(),
  }));
}
```

## Performance Considerations

For high-throughput applications, enable batching:

```dart
final logger = await Logger.create(
  config: LogConfig(
    batching: BatchingConfig(
      enabled: true,
      batchSize: 100,
      flushInterval: const Duration(milliseconds: 500),
    ),
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
  ),
);
```

## Shutdown Handling

Always shutdown when using file drivers or in CLI applications:

```dart
final logger = await Logger.create(/* config with file channels */);

try {
  // Application logic
} finally {
  await logger.shutdown();
}
```

## Next Steps

- [API Reference](/api/overview)
- [Advanced Features](/advanced/middleware)
- [Migration Guide](/migration/v2)
- [Type Formatters & Printers](/advanced/type-formatters)
