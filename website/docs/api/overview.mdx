---
title: API Overview
description: Key classes, configuration patterns, and advanced capabilities available in Contextual.
---

# API Overview

Contextual's API is designed to be intuitive and flexible, providing a rich set of features for logging in Dart applications.

## Core Components

### Logger

The main class for logging operations. It manages log channels, formatting, and message processing.

```dart
final logger = await Logger.create(
  config: LogConfig(
    environment: 'production',
    formatter: JsonLogFormatter(),
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
  ),
);
```

Key methods:
- `log(Level level, dynamic message, [Context? context])`: Core logging method
- `forDriver<T extends LogDriver>([String? name])`: Target specific driver types
- `addMiddleware(Middleware middleware)`: Add global middleware
- `withContext(Map<String, dynamic> context)`: Add shared context
- `setLevel(Level level)`: Set minimum log level


#### Runtime Channels

Each channel is represented at runtime by a typed channel object that bundles:
- the channel `name`
- the driver options
- an optional `formatter`
- optional `middlewares` (applied after global middleware)

```dart
// Channels are configured via LogConfig
final logger = await Logger.create(
  config: LogConfig(
    channels: [
      ConsoleChannel(
        ConsoleOptions(),
        name: 'console',
        formatter: PrettyLogFormatter(),
      ),
    ],
  ),
);

// Access channels by name or type
final consoleChannel = logger['console'];
final consoleLogger = logger.forDriver<ConsoleLogDriver>();
```

You can target drivers by type:

```dart
logger.forDriver<ConsoleLogDriver>().info('Only console drivers');

// Add driver-specific middleware without naming the driver
logger.addDriverMiddleware<ConsoleLogDriver>(SensitiveDataFilter());
```

### LogDriver

Abstract base class for implementing log drivers. Built-in drivers include:

- `ConsoleLogDriver`: Terminal output with color support
- `DailyFileLogDriver`: Daily rotating file logs
- `WebhookLogDriver`: HTTP webhook integration
- `StackLogDriver`: Combines multiple drivers
- `SamplingLogDriver`: Probabilistic logging

Example custom driver:
```dart
class CustomLogDriver extends LogDriver {
  CustomLogDriver() : super('custom');

  @override
  Future<void> log(LogEntry entry) async {
    // Custom log handling
  }
}
```

Drivers are now constructed via typed options:
```dart
// Old way (deprecated)
final driver = DailyFileLogDriver('logs/app.log');

// New way
final driver = DailyFileLogDriver.fromOptions(
  DailyFileOptions(path: 'logs/app.log'),
);
```

### Context

Container for structured log data:

```dart
final context = Context({
  'user_id': 'user123',
  'request_id': 'req456',
  'metadata': {
    'version': '1.0.0',
    'environment': 'production'
  }
});
```

### LogEntry

Represents a single log message with metadata:

```dart
class LogEntry {
  final LogRecord record;
  final String formattedMessage;
  
  // Contains:
  // - Level
  // - Message
  // - Context
  // - Timestamp
  // - Stack trace
}
```

### Formatters

Format log entries into strings:

- `PlainTextLogFormatter`: Simple text output
- `JsonLogFormatter`: JSON-formatted logs
- `PrettyLogFormatter`: Colored, human-readable output
- `RawLogFormatter`: Unformatted message only
- `NullLogFormatter`: No formatting

Custom formatter example:
```dart
class CustomFormatter extends LogMessageFormatter {
  @override
  String format(LogRecord record) {
    return '[${record.level}] ${record.message}';
  }
}
```

Formatters can be configured per channel:
```dart
// Channels are configured via LogConfig
final logger = await Logger.create(
  config: LogConfig(
    channels: [
      ConsoleChannel(
        ConsoleOptions(),
        name: 'console',
        formatter: PrettyLogFormatter(),
      ),
      DailyFileChannel(
        DailyFileOptions(path: 'logs/app'),
        name: 'file',
        formatter: JsonLogFormatter(),
      ),
    ],
  ),
);
```

## Advanced Features

### Batching

Batches log messages for efficient processing via `BatchingConfig`:

```dart
final logger = await Logger.create(
  config: LogConfig(
    batching: BatchingConfig(
      enabled: true,
      batchSize: 100,
      flushInterval: Duration(milliseconds: 500),
    ),
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
  ),
);
```

### Middleware

Transform or enrich log entries with a single pipeline:

```dart
final logger = await Logger.create(
  config: LogConfig(
    channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
    middlewares: [
      () => {
        'timestamp': DateTime.now().toIso8601String(),
        'process_id': Platform.pid,
      },
    ],
  ),
);

// Driver-specific middleware
logger.addDriverMiddleware<ConsoleLogDriver>(SensitiveDataFilter());
```

### Type Formatters

Custom formatting for specific types:

```dart
logger.addTypeFormatter<Error>(ErrorLogFormatter());
```

Type formatters work with the new serialization system. For a deeper dive, including real-world patterns and custom printers, see [Type Formatters & Printers](/advanced/type-formatters).

## Configuration

### LogConfig

Configure channels through typed objects:

```dart
final config = LogConfig(
  environment: 'production',
  level: 'info',
  formatter: JsonLogFormatter(),
  batching: BatchingConfig(
    enabled: true,
    batchSize: 50,
    flushInterval: Duration(seconds: 1),
  ),
  channels: const [
    DailyFileChannel(
      DailyFileOptions(path: 'logs/app', retentionDays: 30),
      name: 'file',
    ),
    WebhookChannel(
      WebhookOptions(url: Uri.parse('https://logs.example.com/ingest')),
      name: 'webhook',
    ),
  ],
);

final logger = await Logger.create(config: config);
```

Typed configs support JSON serialization for configuration files.

## Best Practices

1. **Use Structured Logging**
   ```dart
   logger.info('User logged in', Context({
     'user_id': userId,
     'ip_address': ipAddress,
     'login_method': 'oauth'
   }));
   ```

2. **Set Appropriate Log Levels**
   ```dart
   final logger = await Logger.create(
     config: LogConfig(
       level: 'warning', // Only log warning and above in production
       channels: [ConsoleChannel(ConsoleOptions(), name: 'console')],
     ),
   );
   ```

3. **Use Channel-Specific Formatters**
   ```dart
   final logger = await Logger.create(
     config: LogConfig(
       channels: [
         DailyFileChannel(
           DailyFileOptions(path: 'logs/app'),
           name: 'file',
           formatter: JsonLogFormatter(),
         ),
         ConsoleChannel(
           ConsoleOptions(),
           name: 'console',
           formatter: PrettyLogFormatter(),
         ),
       ],
     ),
   );
   ```

4. **Clean Up Resources**
   ```dart
   await logger.shutdown(); // Before application exit
   ```

## Next Steps

- [Daily File Driver](/api/drivers/daily-file)
- [Middleware Guide](/advanced/middleware)
- [Migration to v2](/migration/v2)
- [Type Formatters & Printers](/advanced/type-formatters)
